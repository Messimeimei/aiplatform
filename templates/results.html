{% extends "base.html" %}
{% block title %}检索结果{% endblock %}
{% block container_class %}container py-3{% endblock %}

{% block extra_head %}
<style>
  .results-surface{ background:#fff; color:#212529; border-radius:14px; padding:16px; box-shadow:0 8px 24px rgba(0,0,0,.08); }
  .results-surface .card{ background:#fff; }
  .results-surface .alert{ background:#f8f9fa; color:#212529; }

  /* 悬浮可点 */
  .hover-card {
    transition: transform .15s ease, box-shadow .15s ease;
    cursor: pointer;
    position: relative; /* for stretched-link */
    border: 1px solid rgba(0,0,0,.06);
    border-radius: 12px;
  }
  .hover-card:hover { transform: translateY(-2px); box-shadow: 0 12px 28px rgba(0,0,0,.12); }

  /* 标题与徽章 */
  .card-title { font-weight: 600; }

  /* 多行信息（企业/国家/技术） */
  .meta-block { margin: .25rem 0 .5rem; }
  .meta-line { display: flex; align-items: center; flex-wrap: wrap; gap: .5rem; margin-top: .25rem; }
  .meta-label {
    font-size: .75rem;
    color: #6c757d;
    background: #f1f3f5;
    border-radius: 999px;
    padding: .2rem .5rem;
  }
  .chip {
    font-size: .75rem;
    line-height: 1.6;
    padding: .2rem .5rem;
    border-radius: 999px;
    background: #eef3ff;
    color: #2149b5;
    border: 1px solid #d8e2ff;
  }

  /* 摘要裁切 */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
{% endblock %}

{% block content %}
<div class="results-surface">
  <h1 class="h4 mb-3 text-dark">检索结果</h1>

  <div class="alert border">
    <div class="row g-2 align-items-center">
      <div class="col-auto">
        <span class="badge bg-primary">
          {{ (type_ or request.args.get('type','tech')) == 'product' and '关键产品' or '关键技术' }}
        </span>
      </div>
      <div class="col">
        <strong>关键词：</strong><span class="text-dark">{{ q or request.args.get('q','') }}</span>
      </div>
      <div class="col-auto">
        <a href="{{ url_for('base.index') }}" class="btn btn-sm btn-outline-secondary">返回修改</a>
      </div>
    </div>
  </div>

  {% if items %}
  <div class="row row-cols-1 row-cols-md-2 g-3">
    {% for item in items %}
    <div class="col">
      <div class="card h-100 shadow-sm border-0 hover-card">
        <div class="card-body">
          <!-- 标题 + 类型徽章 -->
          <div class="d-flex align-items-start justify-content-between">
            <h5 class="card-title mb-1 text-dark me-2">{{ item.name }}</h5>
            <span class="badge text-bg-secondary">{{ item.kind }}</span>
          </div>

          <!-- 企业/国家/技术：逐行展示（来自 org 的安全 HTML） -->
          {% if item.org and item.org != '-' %}
          <div class="meta-block small text-muted">
            {{ item.org|safe }}
          </div>
          {% endif %}

          <!-- 摘要：技术可展示，产品已为空避免“典型产品”重复 -->
          {% if item.abstract %}
            <p class="card-text text-dark line-clamp-2 mb-0">{{ item.abstract }}</p>
          {% endif %}

          <!-- 整卡可点 -->
          <a href="{{ url_for('base.detail_page', item_id=item.id) }}" class="stretched-link" aria-label="查看详情：{{ item.name }}"></a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="text-muted">未检索到结果，请更换关键词或切换类型。</div>
  {% endif %}

  <!-- 分页（示例） -->
  <nav class="mt-3" aria-label="分页">
    <ul class="pagination pagination-sm mb-0">
      <li class="page-item disabled"><span class="page-link">上一页</span></li>
      <li class="page-item active"><span class="page-link">1</span></li>
      <li class="page-item">
        <a class="page-link" href="?q={{ q or request.args.get('q','') }}&type={{ type_ or request.args.get('type','tech') }}&page=2">2</a>
      </li>
      <li class="page-item"><a class="page-link" href="#">下一页</a></li>
    </ul>
  </nav>
</div>
{% endblock %}
